Goal
Refactor the current Unit Mix/Unit Phase page into a clean, sectioned layout that’s easy to scan and edit. Use three collapsible sections (Inputs, Derived, Totals) with a fixed summary panel on the right. Keep the existing data bindings/store; do not change any calculation logic—just reorganize presentation.

Scope

Only the Unit Mix/Phase page.

No back-end changes.

No new math: all totals/derived values continue to come from our central calculator.

Preserve keyboard navigation and editing speed.

Deliverables

A new page layout that divides the unit table into three collapsible cards:

Section A: Inputs (Type, Units, Size, Sales £/unit)

Section B: Derived (GIA, GDV by type, optional Build Cost by type if available, Profit by type if already computed elsewhere)

Section C: Totals (GDV total, GIA total, Cost total if available, Profit, Profit %, Residual land value if land cost unknown)

A fixed right-hand Summary Panel showing: GDV, Total Costs (as available), Profit, PoGDV %, PoC %, Status chip (Green/Amber/Red), with a small assumptions note.

Progressive disclosure:

The Inputs section is expanded by default,

Derived is collapsed by default,

Totals is expanded by default.

Add a “Show Advanced” toggle that, when ON, shows additional optional columns in Inputs (e.g., cost per m²/ per unit if present) and reveals Derived section by default.

Density fit banner (non-blocking) under the Inputs header: “Estimated density: X dph; LA typical: Y–Z dph.” (Use existing store values; if unavailable, show “—”).

Row interaction pattern: each row has an Edit button that opens a compact modal grouping that row’s fields (Type, Units, Size m²/ft², Sales £/unit). Inline editing remains for Units and Sales £/unit columns, but the modal offers a clean experience for full edits.

Phase support (if phases exist): Provide a tabbed header above Sections A–C (Phase 1, Phase 2, etc.). Each tab switches the dataset slice without reflowing the summary panel. If phases aren’t implemented yet, keep a single tab (“All Units”).

Sticky table headers for each section so column labels stay visible while scrolling within that section.

Readability & spacing: generous row height, consistent padding, alternating row background, and clear numeric alignment (right-align numbers, left-align labels).

Responsive:

Desktop: three sections stacked vertically, summary fixed to the right.

Tablet/mobile: summary panel collapses to a top card; sections stack full width; collapse Derived by default.

Accessibility:

All controls keyboard navigable (Tab/Shift+Tab).

Visible focus states.

ARIA labels for collapsible buttons (“Expand Inputs”, “Collapse Derived”).

Color not the only status indicator (include text labels).

File & Component Work

Create/Update a dedicated component for this page: UnitMixPage (or update the existing page).

New components (or refactor existing):

UnitMixInputsSection (Section A)

UnitMixDerivedSection (Section B)

UnitMixTotalsSection (Section C)

UnitMixRowModal (for per-row edit)

UnitMixSummaryPanel (fixed right card)

PhaseTabs (optional; render only if multiple phases exist)

Styling: use existing design system (Tailwind/shadcn if available). Keep visuals consistent with the rest of the app (rounded-lg cards, soft shadows, subtle dividers).

Data Binding & Columns

Section A – Inputs (Editable)

Columns (shown by default):

Type (select)

Units (number, inline editable)

Size (m²) (number)

Sales £/unit (number, inline editable)

Hidden under “Show Advanced” toggle:

Size (ft²) (auto/derived from m² but user-editable if that’s current behavior)

Build Cost / unit OR Build Cost / m² (only if these fields already exist in store)

Notes/Variant (optional free text per row if already present)

Section B – Derived (Read-only)

Columns:

GIA by type (units × size m²)

GDV by type (units × sales £/unit)

Build Cost by type (if that exists; otherwise omit)

Profit by type (if already computed; otherwise omit)

Section C – Totals (Read-only)

Rows (key metrics):

Total Units

Total GIA (m²/ft²)

Total GDV

Total Build Cost (if available)

Profit

Profit on GDV %

Profit on Cost %

Residual Land Value (if land cost is blank)

If a metric is not available in the current step, show “—” with a tooltip: “Will populate when [X] is set.”

Right-hand Summary Panel (Fixed)

Show: GDV, Total Cost (as available), Profit, PoGDV %, PoC %, Status chip.

Below metrics: a small Assumptions block (e.g., “Profit target 20% PoGDV • Land cost unknown → residual mode”).

The panel stays visible on desktop while scrolling sections.

Controls & UX

Search/Filter input above Section A to filter unit types by name (optional).

Add Row button at the top-right of Section A.

Bulk Actions (optional): duplicate selected rows, delete selected rows.

Show Advanced toggle (top-right of page) to reveal advanced columns + expand Derived section by default.

Density banner under Section A header, non-blocking info style.

Tooltips on column headers for first-time users (“Sales £/unit: market sale price per dwelling”).

Inline validation: no negative numbers; warn if units push density far outside local hint (soft warning).

Behavioral Rules

All totals/derived values must come from existing selectors/helpers—no new inline math in the view components.

Edits update the store immediately and refresh the Derived/Totals sections and Summary Panel in real-time.

Collapsible state persists per session (remember which sections user opened/closed).

Phases: switching tabs keeps the summary panel pinned and recalculates metrics for the active phase (if we support per-phase metrics); otherwise show global metrics with a note “Showing global totals”.

Empty States

If no rows:

Inputs: “No unit types added yet. Click ‘Add Row’ or ‘Suggest Mix’.”

Derived/Totals: greyed out with “Populate Units to calculate.”

If land cost missing: Totals footer shows “Residual mode active: Max land value will be shown.”

Testing & Acceptance Criteria

Editing Units or Sales £/unit updates GDV by type, GDV total, and summary metrics instantly.

Collapsing/expanding sections does not affect data; just the view.

On desktop, the right Summary Panel remains fixed while scrolling content.

“Show Advanced” reveals extra columns and auto-expands Derived.

Keyboard: Tab through inputs, Enter to confirm inline edits, Esc to close row modal.

Mobile: Summary collapses to top card; sections stack; Derived collapsed by default.

No console errors; no layout shift/jank on expand/collapse.

No new math is implemented in the view—everything uses existing computed selectors.

Non-Goals / Out of Scope (for this task)

No changes to underlying math.

No provider/API changes.

No new charts (optional for later).

No new export formats.

Style Guidance

Cards with titles: Inputs, Derived, Totals.

Subtle dividers, 12–16px padding inside cells, 8px row gaps.

Right-align numeric columns, use monospace font for numbers if available to improve scan.

Status chip colors: Green/Amber/Red with text labels (e.g., “GREEN • Viable”).

Keep it clean, like HelloData: fewer borders, more whitespace, clear hierarchy.